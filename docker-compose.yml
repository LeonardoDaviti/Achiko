version: "3.8"
services:
  tg-download-bot:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        APP_UID: 1000
        APP_GID: 1000
    environment:
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN}
      ALLOWED_TELEGRAM_USER_ID: ${ALLOWED_TELEGRAM_USER_ID}
      DOWNLOAD_ROOT: ${DOWNLOAD_ROOT}
      UPLOAD_ROOT: ${UPLOAD_ROOT}
    volumes:
      - ${DOWNLOAD_ROOT}:${DOWNLOAD_ROOT}:rw
      - ${UPLOAD_ROOT}:${UPLOAD_ROOT}:rw
    # Security hardening (works in Portainer standalone stacks)
    read_only: true
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges:true
    tmpfs:
      - /tmp:rw,nosuid,nodev,noexec,size=64m
    user: "1000:1000"
    restart: unless-stopped
